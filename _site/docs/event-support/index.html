<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Event support</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="OWNER • Java™ properties reinvented. - Feed" href="/feed.xml" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to OWNER’s master branch" href="https://github.com/lviggiano/owner/commits/master.atom" />
  <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Arizonia' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="http://localhost:4000/css/normalize.css" />
  <link rel="stylesheet" href="http://localhost:4000/css/gridism.css" />
  <link rel="stylesheet" href="http://localhost:4000/css/style.css" />
  <link rel="stylesheet" href="http://localhost:4000/css/pygments.css" />
  <link rel="icon" type="image/x-icon" href="http://localhost:4000/favicon.png" />
  <script src="http://localhost:4000/js/modernizr-2.5.3.min.js"></script>
</head>


<body class="wrap">

  <header>
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="http://localhost:4000/">Overview</a>
  </li>
  <li class="current">
    <a href="http://localhost:4000/docs/welcome">Doc<span class="show-on-mobiles">s</span><span class="hide-on-mobiles">umentation</span></a>
  </li>
  <li class="">
    <a href="http://localhost:4000/news">News</a>
  </li>
  <li class="">
    <a href="https://github.com/lviggiano/owner"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <a href="http://localhost:4000/">
        <h1>
          <span class="shadow">OWNER</span>
        </h1>
        <small class="shadow">Java&trade; properties reinvented.</small>
      </a>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="http://localhost:4000/">Overview</a>
  </li>
  <li class="current">
    <a href="http://localhost:4000/docs/welcome">Doc<span class="show-on-mobiles">s</span><span class="hide-on-mobiles">umentation</span></a>
  </li>
  <li class="">
    <a href="http://localhost:4000/news">News</a>
  </li>
  <li class="">
    <a href="https://github.com/lviggiano/owner"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

    </nav>
  </div>
  <div class="ribbon">
    <a href="https://github.com/lviggiano/owner"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>
  </div>
</header>


    <section class="docs">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
    <select onchange="if (this.value) window.location.href=this.value">

        <option value="">Navigate the docs…</option>

        <optgroup label="Getting started">
            <option value="http://localhost:4000/docs/welcome/">Welcome</option>
            <option value="http://localhost:4000/docs/installation/">Installation
            </option>
            <option value="http://localhost:4000/docs/usage/">Basic usage</option>
        </optgroup>

        <optgroup label="More Features">
            <option value="http://localhost:4000/docs/loading-strategies/">Loading strategies</option>
            <option value="http://localhost:4000/docs/importing-properties/">Importing properties</option>
            <option value="http://localhost:4000/docs/parametrized-properties/">Parametrized properties</option>
            <option value="http://localhost:4000/docs/type-conversion/">Type conversion</option>
            <option value="http://localhost:4000/docs/variables-expansion/">Variables expansion</option>
            <option value="http://localhost:4000/docs/reload/">Reload and Hot Reload</option>
            <option value="http://localhost:4000/docs/accessible-mutable/">Accessible and Mutable</option>
            <option value="http://localhost:4000/docs/debugging/">Debugging</option>
            <option value="http://localhost:4000/docs/disabling-features/">Disabling features</option>
            <option value="http://localhost:4000/docs/configuring/">Metaconfiguring</option>
            <option value="http://localhost:4000/docs/xml-support/">XML support</option>
            <option value="http://localhost:4000/docs/event-support/">Event support</option>
            <option value="http://localhost:4000/docs/singleton/">Singleton</option>
        </optgroup>

        <optgroup label="Miscellaneous">
            <option value="http://localhost:4000/docs/features/">Features</option>
            <option value="http://localhost:4000/docs/why/">Why OWNER?</option>
            <option value="http://localhost:4000/docs/faq/">FAQ</option>
            <option value="http://localhost:4000/docs/support/">Getting support</option>
        </optgroup>

        <optgroup label="Meta">
            <option value="http://localhost:4000/docs/building/">Building from sources</option>
            <option value="http://localhost:4000/docs/contributing/">Contributing</option>
            <option value="http://localhost:4000/docs/license/">License</option>
        </optgroup>

        <optgroup label="Other stuff">
            <option value="http://localhost:4000/news/releases/">History</option>
            <option value="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.aeonbits.owner%22%20AND%20a%3A%22owner%22">Downloads</option>
            <option value="https://github.com/lviggiano/owner/releases">Releases</option>
            <option value="http://owner.newinstance.it/latest/apidocs/index.html">Javadocs</option>
            <option value="https://aeonbits.ci.cloudbees.com/job/owner-api/">Jenkins reports</option>
            <option value="https://travis-ci.org/lviggiano/owner">Travis CI reports</option>
            <option value="http://dev.aeonbits.org:9000/dashboard/index/org.aeonbits.owner:owner">Sonar reports</option>
            <option value="https://coveralls.io/r/lviggiano/owner">Coveralls reports</option>
            <option value="http://newinstance.it/owner/latest/">Maven site</option>
            <option value="https://www.ohloh.net/p/owner">OWNER at Ohloh</option>
        </optgroup>

    </select>
</div>


      <div class="unit four-fifths">
        <article>
          <h1>Event support</h1>
          <p>The HotReload is a cool feature, however it would be nice to know which properties has changed so that you can
re-configure only the affected services.</p>

<p>This is why OWNER implements a feature rich event system that allows to know when a reload event occurs, when a
property is changed, and lets you to check if the new value is compliant to your application requirements and,
if not, you can rollback the property change or the entire change set.</p>

<h2 id="listening-for-reloads">Listening for Reloads</h2>

<p>As explained in <a href="http://localhost:4000/docs/reload/">Reload and Hot Reload</a> section, OWNER supports programmatic reload and
automatic reload (when a configuration file is changed). In both cases a reload event is generated.</p>

<p>To get notified when a reload event occurs, your interface must extend <code>Reloadable</code> that exposes some methods to
register a <code>ReloadListener</code>.</p>

<p>There is also the possibility to implement a <code>TransactionalReloadListener</code> which does notify you before the reload
becomes effective and allows you to check what is changed and eventually to rollback the reload operation if the
changes you see are not compliant to your application&#39;s requirements.</p>

<p><img src="http://localhost:4000/img/reload-event.png" alt="reload-event"></p>

<p>The <code>Reloadable</code> interfaces allows to attach and remove <code>ReloadListener</code> objects.</p>

<p>The <code>ReloadListener</code> interface defines a method called <code>reloadPerformed()</code> that receives a <code>ReloadEvent</code> which contains
the <code>oldProperties</code> (before the reload) and the <code>newProperties</code> (after the reload) plus a list of <code>PropertyChangeEvent</code>
for every property which is changed.</p>

<p>The <code>PropertyChangeEvent</code> contains the <code>propertyName</code>, the <code>oldValue</code> and the <code>newValue</code>.</p>

<p>When calling the method <code>Reloadable.addReloadListener()</code> it is possible to pass an instance of
<code>TransactionalReloadListener</code> which extends the <code>ReloadListener</code> adding the method <code>beforeReload()</code>.
This listener receives the notification just after the reload is triggered and before the changes are effective. In this
way it is possible for this listener to check what is changed and, if the changes are not welcome, it can trigger the
exception <code>RollbackBatchException</code> which means that all the changes in the reload will be discarded, and the current
values will be kept.
If the <code>RollbackBatchException</code> is thrown, the <code>ReloadListener.reloadPerformed()</code> will not be invoked, since the reload
has been aborted by the listener.</p>

<p>Example:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Sources</span><span class="o">(</span><span class="s">&quot;Example.properties&quot;</span><span class="o">)</span>
<span class="kd">interface</span> <span class="nc">MyConfig</span> <span class="kd">extends</span> <span class="n">Reloadable</span> <span class="o">{</span>
    <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;5&quot;</span><span class="o">)</span>
    <span class="n">Integer</span> <span class="nf">someInteger</span><span class="o">();</span>

    <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;foobar&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">someString</span><span class="o">();</span>

    <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;3.14&quot;</span><span class="o">)</span>
    <span class="n">Double</span> <span class="nf">someDouble</span><span class="o">();</span>

    <span class="n">String</span> <span class="nf">nullsByDefault</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">MyConfig</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">MyConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="kd">final</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">reloadPerformed</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="o">{</span><span class="kc">false</span><span class="o">};</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">addReloadListener</span><span class="o">(</span><span class="k">new</span> <span class="nf">TransactionalReloadListener</span><span class="o">()</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeReload</span><span class="o">(</span><span class="n">ReloadEvent</span> <span class="n">event</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">RollbackBatchException</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">notAllowedValue</span> <span class="o">=</span> <span class="s">&quot;42&quot;</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">newSomeInteger</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getNewProperties</span><span class="o">()</span>
            <span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">);</span>

        <span class="c1">// 42 makes the reload to rollback completely!</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">notAllowedValue</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">newSomeInteger</span><span class="o">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RollbackBatchException</span><span class="o">(</span>
              <span class="s">&quot;42 is not allowed for property &#39;someInteger&#39;&quot;</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reloadPerformed</span><span class="o">(</span><span class="n">ReloadEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">});</span>

<span class="c1">// we update the properties file in the filesystem</span>
<span class="n">File</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">&quot;Example.properties&quot;</span><span class="o">);</span>
<span class="n">save</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Properties</span><span class="o">()</span> <span class="o">{</span> <span class="o">{</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;41&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someString&quot;</span><span class="o">,</span> <span class="s">&quot;bazbar&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someDouble&quot;</span><span class="o">,</span> <span class="s">&quot;2.718&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;nullsByDefault&quot;</span><span class="o">,</span> <span class="s">&quot;NotNullNow&quot;</span><span class="o">);</span>
<span class="o">}});</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">reload</span><span class="o">();</span>

<span class="c1">// reload happened</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">41</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;bazbar&quot;</span><span class="o">,</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someString</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Double</span><span class="o">(</span><span class="s">&quot;2.718&quot;</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someDouble</span><span class="o">());</span>
<span class="n">assertNotNull</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">nullsByDefault</span><span class="o">());</span>

<span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// reset the flag</span>

<span class="n">save</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Properties</span><span class="o">()</span> <span class="o">{</span> <span class="o">{</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;42&quot;</span><span class="o">);</span> <span class="c1">// not allowed!</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someString&quot;</span><span class="o">,</span> <span class="s">&quot;blahblah&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someDouble&quot;</span><span class="o">,</span> <span class="s">&quot;1.234&quot;</span><span class="o">);</span>
<span class="o">}});</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">reload</span><span class="o">();</span>

<span class="c1">// reload was rolled back since 42 is not allowed</span>
<span class="n">assertFalse</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">41</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;bazbar&quot;</span><span class="o">,</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someString</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Double</span><span class="o">(</span><span class="s">&quot;2.718&quot;</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someDouble</span><span class="o">());</span>
<span class="n">assertNotNull</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">nullsByDefault</span><span class="o">());</span>
</code></pre></div>
<h2 id="listening-for-propertychanges">Listening for PropertyChanges</h2>

<p>A <code>PropertyChangeEvent</code> happens every time the user changes a property using a method declared in the <code>Mutable</code>
interface, or when a <a href="http://localhost:4000/docs/reload/">reload</a> happens.</p>

<p>To get notified when a property change event occurs, your interface must extend <code>Mutable</code> that exposes some methods to
register a <code>PropertyChangeListener</code>.</p>

<p>There is also the possibility to implement a <code>TransactionalPropertyChangeListener</code> which does notify you before the
property change becomes effective and allows you to check what is changed and eventually to rollback the single
property change operation or the whole set of changes triggered by the source event.</p>

<p><img src="http://localhost:4000/img/propertychange-event.png" alt="propertychange-event"></p>

<p>The <code>Mutable</code> interfaces allows to attach and remove <code>PropertyChangeListener</code> objects. It is possible to attach
a listener to a specific property name, so that the listener will be associated to a single property name:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Mutable</span> <span class="kd">extends</span> <span class="n">Config</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">addPropertyChangeListener</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">PropertyChangeListener</span> <span class="n">listener</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">addPropertyChangeListener</span><span class="o">(</span><span class="n">PropertyChangeListener</span> <span class="n">listener</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">removePropertyChangeListener</span><span class="o">(</span><span class="n">PropertyChangeListener</span> <span class="n">listener</span><span class="o">);</span>
  <span class="c1">// ...the rest of the interface is cut...</span>
<span class="o">}</span>
</code></pre></div>
<p>The <code>Mutable</code> interface defines methods to change the internal values of the properties as well, all of them will
trigger a <code>PropertyChangeEvent</code> and notify the registered listeners:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Mutable</span> <span class="kd">extends</span> <span class="n">Config</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">);</span>
  <span class="n">String</span> <span class="nf">removeProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
  <span class="kt">void</span> <span class="nf">clear</span><span class="o">();</span>
  <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">InputStream</span> <span class="n">inStream</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
  <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">Reader</span> <span class="n">reader</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
  <span class="c1">// ...the rest of the interface is cut...</span>
<span class="o">}</span>
</code></pre></div>
<p>The <code>PropertyChangeListener</code> interface comes from the <code>java.beans</code> package and defines a method called
<code>propertyChange()</code> that receives a <code>PropertyChangeEvent</code> which contains the <code>propertyName</code>, the <code>oldValue</code> and
the <code>newValue</code>.</p>

<p>When calling the method <code>Mutable.addPropertyChangeListener()</code> it is possible to pass an instance of
<code>TransactionalPropertyChangeListener</code> which extends the <code>PropertyChangeListener</code> adding the method
<code>beforePropertyChange()</code>.
This listener receives the notification just after the change is triggered but before the changes become effective.
In this way it is possible for this listener to check what is changed and, if the changes are not welcome, the listener
can trigger the exception <code>RollbackOperationException</code> or <code>RollbackBatchException</code>.</p>

<p>Throwing <code>RollbackOperationException</code> means that the listener wants to rollback the single property change, even though
the property change may have been triggered due to an event who involves many property changes, and only the single
property change needs to be rolled back.
Instead the <code>RollbackBatchException</code> means that all the changes triggered by the source event must be rolled back, and
the previous values must be kept.</p>

<p>If the any of the two <code>RollbackException</code> explained above is thrown, the <code>PropertyChangeListener.propertyChange()</code>
will not be invoked, since the change has been aborted by the listener.</p>

<p>Obviously also the <code>reload()</code> operation happenning during a hot reload, or when invoked via the <code>Reloadable</code> interface
triggers the PropertyChangeEvent.</p>

<p>Example:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Sources</span><span class="o">(</span><span class="s">&quot;Example.properties&quot;</span><span class="o">)</span>
<span class="kd">interface</span> <span class="nc">MyConfig</span> <span class="kd">extends</span> <span class="n">Reloadable</span> <span class="o">{</span>
    <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;5&quot;</span><span class="o">)</span>
    <span class="n">Integer</span> <span class="nf">someInteger</span><span class="o">();</span>

    <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;foobar&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">someString</span><span class="o">();</span>

    <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;3.14&quot;</span><span class="o">)</span>
    <span class="n">Double</span> <span class="nf">someDouble</span><span class="o">();</span>

    <span class="n">String</span> <span class="nf">nullsByDefault</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">MyConfig</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">ConfigFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">MyConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="kd">final</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="n">reloadPerformed</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[]</span> <span class="o">{</span><span class="kc">false</span><span class="o">};</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">addPropertyChangeListener</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span>
        <span class="k">new</span> <span class="nf">TransactionalPropertyChangeListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforePropertyChange</span><span class="o">(</span><span class="n">PropertyChangeEvent</span> <span class="n">event</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">RollbackOperationException</span><span class="o">,</span> <span class="n">RollbackBatchException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">notAllowedValue</span> <span class="o">=</span> <span class="s">&quot;88&quot;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">makesEverythingToRollback</span> <span class="o">=</span> <span class="s">&quot;42&quot;</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">newSomeInteger</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">event</span><span class="o">.</span><span class="na">getNewValue</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">notAllowedValue</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">newSomeInteger</span><span class="o">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RollbackOperationException</span><span class="o">(</span>
                <span class="s">&quot;88 is not allowed for property &#39;someInteger&#39;, &quot;</span> <span class="o">+</span>
                <span class="s">&quot;the single property someInteger is rolled back&quot;</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">makesEverythingToRollback</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">newSomeInteger</span><span class="o">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RollbackBatchException</span><span class="o">(</span>
                <span class="s">&quot;42 is not allowed for property &#39;someInteger&#39;, &quot;</span> <span class="o">+</span>
                <span class="s">&quot;the whole event is rolled back&quot;</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">propertyChange</span><span class="o">(</span><span class="n">PropertyChangeEvent</span> <span class="n">evt</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">save</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Properties</span><span class="o">()</span> <span class="o">{</span> <span class="o">{</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;41&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someString&quot;</span><span class="o">,</span> <span class="s">&quot;bazbar&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someDouble&quot;</span><span class="o">,</span> <span class="s">&quot;2.718&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;nullsByDefault&quot;</span><span class="o">,</span> <span class="s">&quot;NotNullNow&quot;</span><span class="o">);</span>
<span class="o">}});</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">reload</span><span class="o">();</span>

<span class="n">assertTrue</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">41</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;bazbar&quot;</span><span class="o">,</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someString</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Double</span><span class="o">(</span><span class="s">&quot;2.718&quot;</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someDouble</span><span class="o">());</span>
<span class="n">assertNotNull</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">nullsByDefault</span><span class="o">());</span>

<span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;55&quot;</span><span class="o">);</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">55</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>

<span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>


<span class="n">cfg</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;88&quot;</span><span class="o">);</span>
<span class="c1">// 88 is rolled back.</span>
<span class="n">assertFalse</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">55</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>

<span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">save</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Properties</span><span class="o">()</span> <span class="o">{</span> <span class="o">{</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;42&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someString&quot;</span><span class="o">,</span> <span class="s">&quot;blahblah&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someDouble&quot;</span><span class="o">,</span> <span class="s">&quot;1.234&quot;</span><span class="o">);</span>
<span class="o">}});</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">reload</span><span class="o">();</span>

<span class="n">assertFalse</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">55</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;bazbar&quot;</span><span class="o">,</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someString</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Double</span><span class="o">(</span><span class="s">&quot;2.718&quot;</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someDouble</span><span class="o">());</span>
<span class="n">assertNotNull</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">nullsByDefault</span><span class="o">());</span>


<span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

<span class="n">save</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Properties</span><span class="o">()</span> <span class="o">{</span> <span class="o">{</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someInteger&quot;</span><span class="o">,</span> <span class="s">&quot;88&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someString&quot;</span><span class="o">,</span> <span class="s">&quot;this is not rolled back&quot;</span><span class="o">);</span>
    <span class="n">setProperty</span><span class="o">(</span><span class="s">&quot;someDouble&quot;</span><span class="o">,</span> <span class="s">&quot;1.2345&quot;</span><span class="o">);</span>
<span class="o">}});</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">reload</span><span class="o">();</span>

<span class="n">assertFalse</span><span class="o">(</span><span class="n">reloadPerformed</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="c1">// only someInteger=88 is rolled back</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="mi">55</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someInteger</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;this is not rolled back&quot;</span><span class="o">,</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someString</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="k">new</span> <span class="nf">Double</span><span class="o">(</span><span class="s">&quot;1.2345&quot;</span><span class="o">),</span> <span class="n">cfg</span><span class="o">.</span><span class="na">someDouble</span><span class="o">());</span>
<span class="n">assertNull</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">nullsByDefault</span><span class="o">());</span>
</code></pre></div>
<h2 id="conclusions">Conclusions</h2>

<p>With <code>ReloadListener</code> and <code>PropertyChangeListener</code> it is possible to get notified when your configuration changes.
This allows your application to take actions subsequently.</p>

<p>With <code>TransactionalReloadListener</code> and <code>TransactionalPropertyChangeListener</code> you can also check if the changes being
applied are coherent to your requirements and eventually rollback the single property change or the
complete set of changes, keeping things as they where before a reload.</p>

<p>This is a mechanism which allows for some basic validation.
A more simple and powerful validation mechanism is planned for the future releases, and the event mechanism will be
probably the backbone of this.</p>

          <div class="section-nav">
  <div class="left align-right">
    
      <a href="http://localhost:4000/docs/xml-support" class="prev">
        Back
      </a>
    
  </div>
  <div class="right align-left">
    
      <a href="http://localhost:4000/docs/singleton" class="next">
        Next
      </a>
    
  </div>
  <div class="clear"></div>
</div>


        </article>
      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>

    <h4>Getting Started</h4>
    <ul>
      <li class="">
        <a href="http://localhost:4000/docs/welcome">Welcome</a>
      </li>
      <li class="">
        <a href="http://localhost:4000/docs/installation">Installation</a>
      </li>
      <li class="">
        <a href="http://localhost:4000/docs/usage">Basic usage</a>
      </li>
    </ul>

    <h4>More Features</h4>
    <ul>
    <li class="">
    <a href="http://localhost:4000/docs/loading-strategies">Loading strategies</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/importing-properties">Importing properties</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/parametrized-properties/">Parametrized properties</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/type-conversion/">Type conversion</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/variables-expansion/">Variables expansion</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/reload/">Reload and Hot Reload</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/accessible-mutable/">Accessible and Mutable</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/debugging/">Debugging</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/disabling-features/">Disabling features</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/configuring/">Metaconfiguring</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/xml-support/">XML support</a>
    </li>
    <li class="current">
    <a href="http://localhost:4000/docs/event-support/">Event support</a>
    </li>
    <li class="">
    <a href="http://localhost:4000/docs/singleton/">Singleton</a>
    </li>
</ul>


    <h4>Miscellaneous</h4>
    <ul>
        <li class="">
            <a href="http://localhost:4000/docs/features/">Features</a>
        </li>
        <li class="">
          <a href="http://localhost:4000/docs/why/">Why OWNER?</a>
        </li>
        <li class="">
            <a href="http://localhost:4000/docs/faq/">FAQ</a>
        </li>

        <li class="">
            <a href="http://localhost:4000/docs/support/">Getting support</a>
        </li>
    </ul>

    <h4>Meta</h4>
    <ul>
      <li class="">
        <a href="http://localhost:4000/docs/building">Building from sources</a>
      </li>
      <li class="">
        <a href="http://localhost:4000/docs/contributing">Contributing</a>
      </li>
      <li class="">
        <a href="http://localhost:4000/docs/license">License</a>
      </li>
    </ul>

    <h4>Other stuff</h4>
    <ul>
      <li><a href="http://localhost:4000/news/releases/">History</a></li>
      <li><a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22org.aeonbits.owner%22%20AND%20a%3A%22owner%22">Downloads</a></li>
      <li><a href="https://github.com/lviggiano/owner/releases">Releases</a></li>
      <li><a href="http://owner.newinstance.it/latest/apidocs/index.html">Javadocs</a></li>
      <li><a href="https://aeonbits.ci.cloudbees.com/job/owner-api/">Jenkins reports</a></li>
      <li><a href="https://travis-ci.org/lviggiano/owner">Travis CI reports</a></li>
      <li><a href="http://dev.aeonbits.org:9000/dashboard/index/org.aeonbits.owner:owner">Sonar reports</a></li>
      <li><a href="https://coveralls.io/r/lviggiano/owner">Coveralls reports</a></li>
      <li><a href="http://newinstance.it/owner/latest/">Maven site</a></li>
      <li><a href="https://www.ohloh.net/p/owner">OWNER at Ohloh</a></li>
    </ul>

  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer>
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>Project maintained by <a href="https://github.com/lviggiano">Luigi R. Viggiano</a>,
          and the <a href="https://github.com/lviggiano/owner/graphs/contributors">awesome contributors</a>.</p>
    </div>
    <div class="unit two-thirds align-right center-on-mobiles">
      <p>
        Hosted on
        <a href="https://github.com">
          <img src="http://localhost:4000/img/footer-logo.png" alt="GitHub • Social coding">
        </a>
      </p>
    </div>
  </div>
</footer>

  


  <!-- Google Analytics (http://google.com/analytics) -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-462505-8']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



</body>

</html>

